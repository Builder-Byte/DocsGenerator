{
  "imports": [
    "typing.Union",
    "os",
    "zipfile",
    "shutil",
    "uuid",
    "fastapi.FastAPI",
    "fastapi.File",
    "fastapi.UploadFile",
    "fastapi.HTTPException",
    "fastapi.BackgroundTasks",
    "fastapi.responses.FileResponse",
    "fastapi.responses.JSONResponse",
    "fastapi.middleware.cors.CORSMiddleware",
    "summarize.Summarize"
  ],
  "functions": [
    {
      "name": "summarizer",
      "args": [
        "folder_to_be_summarized",
        "name",
        "session_id"
      ],
      "returns": "None",
      "docstring": "Run summarization in background with session tracking."
    },
    {
      "name": "zip_folder",
      "args": [
        "name",
        "session_id"
      ],
      "returns": "str",
      "docstring": "Zip the output folder for a given session."
    },
    {
      "name": "read_root",
      "args": [],
      "returns": "dict",
      "docstring": null
    }
  ],
  "classes": [],
  "docstrings": {
    "module": null,
    "functions": {
      "summarizer": "Run summarization in background with session tracking.",
      "zip_folder": "Zip the output folder for a given session.",
      "read_root": null
    },
    "classes": {}
  },
  "type_hints": {
    "summarizer": {
      "args": {
        "folder_to_be_summarized": "str",
        "name": "str",
        "session_id": "str"
      },
      "returns": "None"
    },
    "zip_folder": {
      "args": {
        "name": "str",
        "session_id": "str"
      },
      "returns": "str"
    },
    "read_root": {
      "args": {},
      "returns": "dict"
    }
  },
  "constants": [],
  "cross_library_functions": {
    "typing.Union": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "os": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "zipfile": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "shutil": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "uuid": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "fastapi.FastAPI": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "fastapi.File": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "fastapi.UploadFile": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "fastapi.HTTPException": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "fastapi.BackgroundTasks": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "fastapi.responses.FileResponse": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "fastapi.responses.JSONResponse": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "fastapi.middleware.cors.CORSMiddleware": {
      "source_file": null,
      "functions": [],
      "classes": [],
      "is_local": false,
      "note": "External library"
    },
    "summarize.Summarize": {
      "source_file": "summarize.py",
      "functions": [
        "summarize",
        "_update_progress",
        "__init__"
      ],
      "classes": [
        "Summarize"
      ],
      "is_local": true
    }
  },
  "file_name": "server.py",
  "summary": "# **API Documentation**\n\n## Table of Contents\n\n1. [Overview](#overview)\n2. [Architecture & Design](#architecture-design)\n3. [Public Interfaces](#public-interfaces)\n4. [Internal Logic](#internal-logic)\n5. [Configuration & Environment](#configuration-environment)\n6. [Usage Examples](#usage-examples)\n7. [Edge Cases & Constraints](#edge-cases-constraints)\n8. [Best Practices & Notes](#best-practices-notes)\n\n## Overview\n\nThis FastAPI application provides a simple API for uploading ZIP files, extracting their contents, and running a summarization process on the extracted files in the background. It uses unique session IDs for multi-user isolation and tracks the processing status of each session.\n\n## Architecture & Design\n\nThe application follows a simple, modular design with the following key components:\n\n- **Main Application (`__init__.py`)**\n  - Initializes the FastAPI application and configures CORS.\n  - Sets up the directories for uploads, extracted files, and output.\n  - Tracks the processing status of each session.\n\n- **Summarizer Function (`summarizer`)**\n  - Runs the summarization process in the background with session tracking.\n  - Passes the processing status and output directory to the `Summarize` class for progress updates.\n\n- **Zip Folder Function (`zip_folder`)**\n  - Zips the output folder for a given session after the summarization process is completed.\n\n- **Dependencies**\n  - `fastapi`: FastAPI framework for building the API.\n  - `summarize`: Custom module for summarization process (imported from `summarize.py`).\n\n## Public Interfaces\n\n### Endpoints\n\n#### `GET /`\n\n- **Purpose:** Check if the API is running.\n- **Response:** A JSON response with the status \"running\".\n\n#### `GET /download/{name}`\n\n- **Purpose:** Download the generated ZIP file by name.\n- **Parameters:**\n  - `name` (str): The name of the ZIP file to download.\n- **Response:** A `FileResponse` containing the requested ZIP file.\n- **Exceptions:**\n  - `404 Not Found`: Raised if the ZIP file is not found.\n\n#### `GET /status/{session_id}`\n\n- **Purpose:** Get the processing status for a given session.\n- **Parameters:**\n  - `session_id` (str): The session ID to retrieve the status for.\n- **Response:** A JSON response containing the processing status for the given session ID.\n- **Exceptions:**\n  - `404 Not Found`: Raised if the session ID is not found.\n\n#### `GET /sessions`\n\n- **Purpose:** List all active processing sessions and their statuses.\n- **Response:** A JSON response containing a list of active sessions and their total count.\n\n#### `POST /upload`\n\n- **Purpose:** Accept a ZIP file upload and extract its contents.\n- **Request Body:**\n  - `file` (UploadFile): The ZIP file to upload.\n- **Response:** A JSON response containing the processing status, filename, session ID, and message.\n- **Exceptions:**\n  - `400 Bad Request`: Raised if the file is not a ZIP file or if the extracted folder is not found.\n\n## Internal Logic\n\n### Critical Algorithms or Workflows\n\n1. **File Upload and Extraction:**\n   - The application generates a unique session ID for each uploaded file.\n   - It saves the uploaded file to a session-specific directory and extracts its contents to another session-specific directory.\n   - The application looks for a nested folder with the same name as the uploaded ZIP file and uses it as the folder to be summarized if found.\n\n2. **Summarization Process:**\n   - The `summarizer` function runs the summarization process in the background using the `Summarize` class from the `summarize` module.\n   - It passes the processing status and output directory to the `Summarize` class for progress updates.\n\n3. **Zip Folder:**\n   - The `zip_folder` function zips the output folder for a given session after the summarization process is completed.\n   - It uses the session ID in the output path for multi-session isolation.\n\n### Non-obvious Implementation Decisions\n\n- The application uses unique session IDs for multi-user isolation to ensure that each user's uploads and processing are kept separate.\n- It tracks the processing status of each session to provide real-time updates on the progress of the summarization process.\n\n## Configuration & Environment\n\n### Required Environment Variables\n\n- None\n\n### Configuration Options\n\n- The `CORS` middleware allows all origins, credentials, methods, and headers for simplicity. In a production environment, you should configure specific origins, methods, and headers.\n- The `BASE_DIR`, `UPLOAD_DIR`, `EXTRACT_DIR`, `OUTPUT_DIR`, and `OUTPUT_ZIP_DIR` variables define the directories used for storing uploaded files, extracted files, output files, and zipped output files, respectively.\n\n### External Services or Resources Used\n\n- None\n\n## Usage Examples\n\n### Upload a ZIP File and Start Summarization\n\n```bash\ncurl -X POST -H \"Content-Type: multipart/form-data\" -F \"file=@path/to/your/file.zip\" http://localhost:8000/upload\n```\n\n### Check the Processing Status of a Session\n\n```bash\ncurl -X GET http://localhost:8000/status/<session_id>\n```\n\n### Download the Generated ZIP File\n\n```bash\ncurl -X GET -o output.zip http://localhost:8000/download/<name>\n```\n\n### List All Active Processing Sessions\n\n```bash\ncurl -X GET http://localhost:8000/sessions\n```\n\n## Edge Cases & Constraints\n\n### Limitations\n\n- The application assumes that the uploaded ZIP file contains a folder with the same name as the file (or a nested folder with the same name) that needs to be summarized.\n- It does not support resuming interrupted summarization processes.\n\n### Assumptions\n\n- The application assumes that the `summarize` module provides a working summarization process.\n\n### Performance Considerations\n\n- The application runs the summarization process in the background using FastAPI's `BackgroundTasks` feature, which helps to keep the API responsive while long-running tasks are executed.\n- However, the performance of the summarization process itself is dependent on the `summarize` module and may vary based on the size and complexity of the input data.\n\n## Best Practices & Notes\n\n### Security Considerations\n\n- In a production environment, you should configure the `CORS` middleware to allow only specific origins, methods, and headers.\n- You should also implement proper authentication and authorization mechanisms to protect the API and its resources.\n\n### Maintainability Tips\n\n- Keep the code modular and well-organized to make it easier to maintain and extend.\n- Use meaningful variable and function names to improve code readability.\n- Add comments and docstrings to explain the purpose and functionality of important code sections.\n\n### Extension Points\n\n- The application can be extended by adding new endpoints for different file types or processing tasks.\n- You can also modify the `summarize` module to provide different summarization algorithms or improve the performance of the existing one.\n\n## Style Guidelines\n\n- Follow the [PEP 8](https://www.python.org/dev/peps/pep-0008/) style guide for Python code.\n- Use clear and concise variable, function, and endpoint names to improve code readability.\n- Add docstrings to explain the purpose and functionality of important code sections, modules, and endpoints.\n- Use Markdown formatting for documentation to make it easy to read and navigate."
}
